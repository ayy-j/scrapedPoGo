# scrapedPoGo

A comprehensive web scraper for PokÃ©mon GO event data.

## Table of Contents

- [Quick Start](#quick-start)
- [API Endpoints](#api-endpoints)
- [Data Visualization](#data-visualization)
- [Data Quality Metrics](#data-quality-metrics)
- [JSON Schemas](#json-schemas)
- [Project Structure](#project-structure)
- [Scrapers](#scrapers)
- [Development](#development)
- [License](#license)

---

## Quick Start

### Installation

```bash
npm install
```

### Running Scrapers

```bash
# Scrape all basic data (events, raids, research, eggs, rocket lineups, shinies)
npm run scrape

# Scrape detailed event information
npm run detailedscrape

# Combine detailed data with basic events (also generates per-eventType files)
npm run combinedetails

# Generate unified data file with all datasets and indices
npm run combineall

# Generate data quality metrics
```

### Complete Workflow

For the most comprehensive event data:

```bash
npm run scrape              # Get basic event data
npm run detailedscrape      # Get detailed event info
npm run combinedetails      # Merge details + generate per-eventType files
npm run combineall          # Generate unified data file
```

### Output

All scraped data is saved to the `data/` directory as JSON files:
- `.json` - Formatted for readability
- `.min.json` - Minified for production use

---

## API Endpoints

All data is served from **https://pokemn.quest** and updated every 8 hours via automated scraping.

### Unified Data (Recommended)
- Endpoint: `https://pokemn.quest/data/unified.min.json`
- [Documentation](dataDocumentation/UnifiedData.md)

The unified endpoint combines all datasets into a single payload with:
- All events, raids, eggs, research, shinies, and rocket lineups
- Deduplicated Pokemon index with dex numbers and cross-references
- Pre-computed lookup indices for fast data access
- Summary statistics

### Events
- Formatted: `https://pokemn.quest/data/events.json`
- Minimized: `https://pokemn.quest/data/events.min.json`
- [Documentation](dataDocumentation/Events.md)

#### Event Types (per-type files)

Each `eventType` has its own file containing only events of that type (automatically generated by `combinedetails.js`):

- Formatted: `https://pokemn.quest/data/eventTypes/<eventType>.json`
- Minimized: `https://pokemn.quest/data/eventTypes/<eventType>.min.json`

### Raids
- Formatted: `https://pokemn.quest/data/raids.json`
- Minimized: `https://pokemn.quest/data/raids.min.json`
- [Documentation](dataDocumentation/Raids.md)

### Research
- Formatted: `https://pokemn.quest/data/research.json`
- Minimized: `https://pokemn.quest/data/research.min.json`
- [Documentation](dataDocumentation/Research.md)

### Eggs
- Formatted: `https://pokemn.quest/data/eggs.json`
- Minimized: `https://pokemn.quest/data/eggs.min.json`
- [Documentation](dataDocumentation/Eggs.md)

### Rocket Lineups
- Formatted: `https://pokemn.quest/data/rocketLineups.json`
- Minimized: `https://pokemn.quest/data/rocketLineups.min.json`
- [Documentation](dataDocumentation/RocketLineups.md)

### Shinies
- Formatted: `https://pokemn.quest/data/shinies.json`
- Minimized: `https://pokemn.quest/data/shinies.min.json`
- [Documentation](dataDocumentation/Shinies.md)

---

## Data Visualization

A simple front-end visualization tool is included to browse and verify the scraped data.

### Quick Start

```bash
# Start the local server
npm run serve

# Open in browser
# http://localhost:3000
```

### Features

The visualization provides:
- **Visual catalogue** of all data types (Events, Raids, Research, Eggs, Rocket Lineups, Shinies)
- **Event type examples** showing one event of each type (Community Day, GO Tour, Raid Battles, etc.)
- **Endpoint verification** with status indicators for each API endpoint
- **Responsive design** that works on desktop and mobile
- **Live data loading** from local data files or production API

### What's Displayed

- **Events**: First 3 events with images, dates, and featured Pokemon
- **Raids**: First 6 raid bosses with CP ranges, types, and shiny availability
- **Research**: First 3 research items with task counts
- **Eggs**: First 6 egg hatches with rarity and shiny info
- **Rocket Lineups**: First 4 Team GO Rocket lineups with slot details
- **Shinies**: First 12 shiny Pokemon with release dates
- **Event Types**: One example of each of the 20 event types
- **Unified Data**: Summary statistics for all datasets

### Configuration

The visualization can load data from:
- **Local files** (default): Serves from `data/` directory
- **Production API**: Change `USE_LOCAL_DATA` to `false` in `public/app.js`

See [public/README.md](public/README.md) for detailed documentation.

---

## JSON Schemas

All data files have JSON Schema definitions for validation and type generation. Schemas are available in the [`schemas/`](schemas/) directory.

### Available Schemas

- [eggs.schema.json](schemas/eggs.schema.json) - Egg hatch data
- [events.schema.json](schemas/events.schema.json) - Events data  
- [raids.schema.json](schemas/raids.schema.json) - Raid boss data
- [research.schema.json](schemas/research.schema.json) - Field research data
- [rocketLineups.schema.json](schemas/rocketLineups.schema.json) - Team GO Rocket lineups
- [shinies.schema.json](schemas/shinies.schema.json) - Shiny availability data

### Validation

Validate all data files against their schemas:

```bash
npm run validate
```

### Schema/Data/Docs Comparison

Compare canonical schemas, canonical data files, and markdown documentation:

```bash
npm run compare:schemas
```

Run in strict mode (non-zero exit only for canonical mismatches):

```bash
npm run compare:schemas:strict
```

By default, reports are written to:
- `reports/schema-comparison.json`
- `reports/schema-comparison.md`

You can also run the script directly:

```bash
node src/scripts/compare-docs-data-schemas.js --mode report|strict --json-out <path> --md-out <path> [--no-write]
```

### Usage

See the [schemas README](schemas/README.md) for:
- How to use schemas for validation in your application
- Generating TypeScript types from schemas
- Integration examples

---

## Project Structure

```
scrapedPoGo/
â”œâ”€â”€ src/                    # Source code
â”‚   â”œâ”€â”€ scrapers/           # Pipeline orchestrators
â”‚   â”œâ”€â”€ pages/              # Page-specific scraper modules
â”‚   â”‚   â””â”€â”€ detailed/       # Detailed event scrapers (one per eventType)
â”‚   â”œâ”€â”€ utils/              # Utility functions and helpers
â”‚   â””â”€â”€ scripts/            # Validation, comparison, upload scripts
â”œâ”€â”€ data/                   # Output data files (JSON + .min.json)
â”‚   â””â”€â”€ eventTypes/         # Per-eventType output files
â”œâ”€â”€ dataDocumentation/      # API and data structure documentation
â”‚   â””â”€â”€ eventTypes/         # Per-eventType documentation
â”œâ”€â”€ schemas/                # JSON Schema definitions (draft-07)
â”œâ”€â”€ public/                 # Visualization front-end
â”œâ”€â”€ test/                   # Test files
â”œâ”€â”€ .github/                # CI/CD workflows and Copilot config
â”œâ”€â”€ package.json            # Dependencies and scripts
â””â”€â”€ README.md               # This file
```

### Source Code (`src/`)

#### Main Scrapers (`src/scrapers/`)

| File | Description |
|------|-------------|
| `scrape.js` | Stage 1: Scrapes all basic data types in parallel (events, raids, research, eggs, rocket lineups, shinies) |
| `detailedscrape.js` | Stage 2: Dispatches to type-specific scrapers for detailed event pages (concurrency limit: 5) |
| `combinedetails.js` | Stage 3: Merges temp files into events, flattens structure, generates per-eventType files |
| `combineAll.js` | Bonus: Generates unified data file with all datasets, indices, and statistics |

#### Page Scrapers (`src/pages/`)

| File | Description |
|------|-------------|
| `events.js` | Scrapes event information |
| `raids.js` | Scrapes raid boss data |
| `research.js` | Scrapes field research tasks and rewards |
| `eggs.js` | Scrapes egg hatch pool data |
| `rocketLineups.js` | Scrapes Team GO Rocket lineup data |
| `shinies.js` | Scrapes shiny Pokemon availability |

#### Detailed Event Scrapers (`src/pages/detailed/`)

All detailed scrapers use shared utilities from `scraperUtils.js` for consistent extraction and error handling.

**Core Event Types:**

| File | Event Type | Data Extracted |
|------|------------|----------------|
| `generic.js` | All events | Available sections detection |
| `event.js` | Generic events | Bonuses, spawns, custom sections |
| `communityday.js` | Community Day | Spawns, bonuses, featured attacks, photobombs, showcases, research |
| `spotlight.js` | Spotlight Hour | Featured Pokemon, bonus |
| `breakthrough.js` | Research Breakthrough | Reward Pokemon |

**Raid Event Types:**

| File | Event Type | Data Extracted |
|------|------------|----------------|
| `raidbattles.js` | Raid Battles | Bosses by tier, alternation patterns, featured attacks |
| `raidday.js` | Raid Day | Alternating bosses, ticket bonuses, special mechanics |
| `raidhour.js` | Raid Hour | Single featured boss |

**Research Event Types:**

| File | Event Type | Data Extracted |
|------|------------|----------------|
| `research.js` | Special/Masterwork Research | Tasks, promo codes, pricing, expiration |
| `timedresearch.js` | Timed Research | Tasks, rewards, availability window |

**Seasonal & Large Events:**

| File | Event Type | Data Extracted |
|------|------------|----------------|
| `season.js` | Seasons | Bonuses, eggs by tier, debuts, GO Pass |
| `gotour.js` | GO Tour | Habitats, raids, eggs, research, shiny debuts |

**Battle & Competitive:**

| File | Event Type | Data Extracted |
|------|------------|----------------|
| `gobattleleague.js` | GO Battle League | Leagues, CP caps, type restrictions |
| `teamgorocket.js` | Team GO Rocket | Leaders, Giovanni, shadow Pokemon |

**Max/Dynamax Events:**

| File | Event Type | Data Extracted |
|------|------------|----------------|
| `maxbattles.js` | Max Battles | Dynamax/Gigantamax Pokemon |
| `maxmondays.js` | Max Mondays | Weekly featured Dynamax |

**Other Event Types:**

| File | Event Type | Data Extracted |
|------|------------|----------------|
| `gopass.js` | GO Pass | Point tasks, rewards, milestone bonuses |
| `pokestopshowcase.js` | PokÃ©Stop Showcases | Featured Pokemon |

#### Utilities (`src/utils/`)

| File | Description |
|------|-------------|
| `shinyData.js` | Helper functions for shiny Pokemon data processing |
| `scraperUtils.js` | Shared scraper utilities (see below) |

**`scraperUtils.js` Functions:**

| Function | Description |
|----------|-------------|
| `writeTempFile()` | Write temporary JSON files for scraped data |
| `handleScraperError()` | Centralized error handling with backup fallback |
| `extractPokemonList()` | Extract Pokemon from `.pkmn-list-flex` elements |
| `getSectionHeaders()` | Discover all section headers on a page |
| `extractSection()` | Extract content (paragraphs, lists, pokemon) from a section |
| `extractBonuses()` | Extract bonus items and disclaimers |
| `extractRaidInfo()` | Extract raid boss information by tier |
| `extractResearchTasks()` | Extract special/timed/field research tasks |
| `extractEggPools()` | Extract egg hatches organized by distance tier |
| `extractPrice()` | Extract price information from text |
| `extractPromoCodes()` | Extract promo codes from page links |

---

## Scrapers

### Basic Scraping

```bash
npm run scrape
```

Generates basic data for all endpoints (events, raids, research, eggs, rocket lineups).

### Detailed Event Scraping

```bash
npm run detailedscrape
npm run combinedetails
```

Scrapes additional event-specific data and merges it into the events data. This includes:
- Featured attacks and move stats
- Photobomb Pokemon
- PokÃ©Stop Showcases
- Ticket pricing
- Promo codes
- Research task details
- Habitat spawns (GO Tour)
- And much more...

### Shiny Pokemon Data

Shiny availability data is scraped as part of `npm run scrape` and used to augment `canBeShiny` fields in other endpoints.

---

## Development

### Technical Notes

- All scrapers use [JSDOM](https://github.com/jsdom/jsdom) for HTML parsing
- Temporary files during detailed scraping are stored in `data/temp/` and cleaned up automatically
- The project uses [moment.js](https://momentjs.com/) for date/time handling

### Adding a New Event Type Scraper

1. Create a new file in `src/pages/detailed/`
2. Import utilities from `../../utils/scraperUtils`
3. Export an async `get(url, id, bkp)` function
4. Use `writeTempFile()` to save data and `handleScraperError()` for error handling

Example:

```javascript
const { getJSDOM, writeTempFile, handleScraperError, extractPokemonList } = require('../../utils/scraperUtils');

async function get(url, id, bkp) {
    try {
        const dom = await getJSDOM(url);
        const doc = dom.window.document;

        const data = {
            featured: await extractPokemonList(doc.querySelector('.pkmn-list-flex'))
        };

        if (data.featured.length > 0) {
            writeTempFile(id, 'my-event-type', data);
        }
    } catch (err) {
        handleScraperError(err, id, 'my-event-type', bkp, 'myeventtype');
    }
}

module.exports = { get };
```

### NPM Scripts

| Script | Description |
|--------|-------------|
| `npm run scrape` | Run all scrapers (events, raids, research, eggs, rocket, shinies) |
| `npm run detailedscrape` | Scrape detailed event information |
| `npm run combinedetails` | Combine detailed data with basic events and generate per-eventType files |
| `npm run combineall` | Generate unified data file with all datasets and indices |
| `npm run validate` | Validate all data files against JSON schemas |
| `npm run blob:upload` | Upload images to Vercel Blob Storage (supports `--dry-run`, `--force`) |
| `npm run serve` | Start local visualization server on http://localhost:3000 |
| `npm run build` | Copy data files to public/data for visualization |
| `npm run test` | Run test suite (`node --test`) |
| `npm run compare:schemas` | Compare schemas, data, and docs for consistency |
| `npm run compare:schemas:strict` | Strict mode â€” non-zero exit only for canonical mismatches |
| `npm run pipeline` | Full pipeline (all stages with `USE_BLOB_URLS=true`) |

---

## Vercel Blob Storage

Images referenced in the scraped data can optionally be stored in [Vercel Blob](https://vercel.com/docs/storage/vercel-blob) for self-hosted image delivery.

### Setup

1. Create a Blob store in your Vercel project
2. Configure environment variables for Vercel Blob
3. Add `BLOB_READ_WRITE_TOKEN` to GitHub Actions secrets

### Upload Images

```bash
# Preview what would be uploaded
npm run blob:upload -- --dry-run

# Upload new images to Blob Storage
npm run blob:upload

# Force re-upload all images
npm run blob:upload -- --force
```

### Enable Blob URLs in Output

Set the `USE_BLOB_URLS=true` environment variable to transform image URLs in JSON output to use Vercel Blob storage URLs instead of external CDNs.

The URL mapping is stored in `src/utils/blob-url-map.json` and automatically updated during uploads.
Event banner images are resized to 50% of their source dimensions before upload; corresponding event `imageWidth`/`imageHeight` values reflect the stored (resized) banner dimensions.

### Blob Pathname Scheme

Images are organized by **content type**, not by source. The folder structure is semantic and clean:

```
pokemon/<dex>-<name>/<filename> # Pokemon sprites/icons (e.g., pokemon/155-cyndaquil/pm155.icon.png)
events/<filename>.<ext>         # Event banners (e.g., events/into-the-depths-2026.jpg, events/events-default-img.jpg)
types/<type>.png               # Type icons (e.g., types/fire.png)
weather/<weather>.png          # Weather icons (e.g., weather/sunny.png)
bonuses/<bonus>.png            # Bonus icons (e.g., bonuses/candy.png)
items/<item>.png               # Item icons
eggs/<file>                    # Egg-related images
raids/<file>                   # Raid-related images
stickers/<file>                # Sticker images
misc/<file>                    # Anything else
```

---

## Documentation

### Complete API Reference

**ðŸ“˜ [Complete API Documentation](dataDocumentation/API.md)** - Everything in one place (~3,300 lines)

Comprehensive single-file reference covering all endpoints, data types, event types, field schemas, conventions, and usage examples.

### Modular Documentation

Detailed documentation split by data type:

- [Endpoints](dataDocumentation/Endpoints.md) - Complete API endpoint listing
- [Events](dataDocumentation/Events.md) - Event data with type-specific fields (20 event types)
- [Raids](dataDocumentation/Raids.md) - Raid boss data with CP ranges
- [Research](dataDocumentation/Research.md) - Field research tasks and rewards
- [Eggs](dataDocumentation/Eggs.md) - Egg hatch pools by distance
- [Rocket Lineups](dataDocumentation/RocketLineups.md) - Team GO Rocket lineups
- [Shinies](dataDocumentation/Shinies.md) - Shiny Pokemon availability
- [Unified Data](dataDocumentation/UnifiedData.md) - Combined dataset with indices
- [PokÃ©mon GO Context](.github/docs/POKEMON_GO_CONTEXT.md) - Game mechanics reference

---

## License

MIT
