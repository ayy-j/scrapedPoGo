<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="description" content="Pokémon GO Tour: Kalos - Global 2026 Event Details">
  <meta name="theme-color" content="#1a1a2e">
  <title>Pokémon GO Tour: Kalos - Global 2026</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html {
      -webkit-text-size-adjust: 100%;
      scroll-behavior: smooth;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Outfit', sans-serif;
      font-size: 16px;
      line-height: 1.5;
      color: #e8e8f0;
      background: #0d0d1a;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    :root {
      --x-blue: #4a90d9;
      --x-blue-glow: rgba(74, 144, 217, 0.4);
      --y-red: #d94a6d;
      --y-red-glow: rgba(217, 74, 109, 0.4);
      --mega-gold: #f0c040;
      --shiny-pink: #ff6b9d;
      --bg-dark: #0d0d1a;
      --bg-card: #16162a;
      --bg-card-hover: #1e1e38;
      --border-subtle: rgba(255, 255, 255, 0.08);
      --text-muted: #8a8aa3;
      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 20px;
    }

    /* Background */
    .bg-pattern {
      position: fixed;
      inset: 0;
      z-index: -1;
      overflow: hidden;
    }

    .bg-pattern::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: 
        radial-gradient(ellipse at 20% 20%, var(--x-blue-glow) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, var(--y-red-glow) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(240, 192, 64, 0.1) 0%, transparent 40%);
      animation: bgFloat 20s ease-in-out infinite;
    }

    @keyframes bgFloat {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      33% { transform: translate(2%, 2%) rotate(1deg); }
      66% { transform: translate(-1%, 1%) rotate(-1deg); }
    }

    .grid-overlay {
      position: absolute;
      inset: 0;
      background-image: 
        linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
      background-size: 60px 60px;
      mask-image: radial-gradient(ellipse at center, black 30%, transparent 70%);
    }

    /* Header */
    .header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(13, 13, 26, 0.85);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-subtle);
      padding: var(--spacing-md);
      padding-top: calc(var(--spacing-md) + env(safe-area-inset-top));
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--spacing-md);
    }

    .logo {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.1rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--x-blue), var(--y-red));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: rgba(240, 192, 64, 0.15);
      border: 1px solid rgba(240, 192, 64, 0.3);
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--mega-gold);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      background: var(--mega-gold);
      border-radius: 50%;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(0.8); }
    }

    /* Main */
    .main {
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--spacing-lg);
      padding-bottom: calc(var(--spacing-xl) + env(safe-area-inset-bottom));
    }

    /* Hero */
    .hero {
      position: relative;
      margin-bottom: var(--spacing-xl);
    }

    .hero-image {
      width: 100%;
      aspect-ratio: 16/9;
      object-fit: cover;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
    }

    .hero-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: var(--spacing-lg);
      background: linear-gradient(to top, rgba(13, 13, 26, 0.95), transparent);
      border-radius: 0 0 var(--radius-lg) var(--radius-lg);
    }

    .event-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: clamp(1.5rem, 5vw, 2.5rem);
      font-weight: 700;
      margin: 0 0 var(--spacing-sm);
      line-height: 1.2;
    }

    .event-dates {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      color: var(--text-muted);
      font-size: 0.95rem;
    }

    .event-dates svg {
      width: 18px;
      height: 18px;
      stroke: var(--mega-gold);
    }

    /* Section */
    .section {
      margin-bottom: var(--spacing-xl);
      opacity: 0;
      transform: translateY(30px);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }

    .section.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
    }

    .section-icon {
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-card);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
    }

    .section-icon svg {
      width: 24px;
      height: 24px;
    }

    .section-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: clamp(1.25rem, 3vw, 1.5rem);
      font-weight: 700;
      margin: 0;
    }

    /* Cards */
    .card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      padding: var(--spacing-lg);
      transition: transform 0.2s ease, border-color 0.2s ease;
    }

    .card:hover {
      border-color: rgba(255, 255, 255, 0.15);
    }

    /* Pokemon Grid */
    .pokemon-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: var(--spacing-sm);
    }

    @media (min-width: 480px) {
      .pokemon-grid {
        grid-template-columns: repeat(5, minmax(0, 1fr));
      }
    }

    @media (min-width: 768px) {
      .pokemon-grid {
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      }
    }

    .pokemon-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: var(--spacing-sm) var(--spacing-xs);
      background: var(--bg-card);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      transition: transform 0.2s ease, background 0.2s ease;
      cursor: pointer;
      height: 120px;
      overflow: hidden;
      width: 100%;
    }

    .pokemon-card:hover {
      transform: translateY(-4px);
      background: var(--bg-card-hover);
    }

    .pokemon-card:active {
      transform: scale(0.95);
    }

    .pokemon-img {
      width: 64px;
      height: 64px;
      object-fit: contain;
      image-rendering: pixelated;
    }

    .pokemon-name {
      font-size: 0.7rem;
      text-align: center;
      margin-top: var(--spacing-xs);
      color: var(--text-muted);
      line-height: 1.2;
      width: 100%;
      min-width: 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Type Badges */
    .type-badges {
      display: flex;
      gap: 2px;
      justify-content: center;
      margin-top: 2px;
      flex-wrap: nowrap;
      overflow: hidden;
      width: 100%;
    }

    .type-badge {
      font-size: 0.5rem;
      font-weight: 700;
      padding: 1px 4px;
      border-radius: 6px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      line-height: 1.4;
      white-space: nowrap;
      min-width: 0;
      overflow: hidden;
      text-overflow: ellipsis;
      flex-shrink: 1;
    }

    .type-badge-img {
      height: 14px;
      width: auto;
      flex-shrink: 1;
      min-width: 0;
      display: block;
    }

    .habitat-spawns .type-badges {
      margin-top: 1px;
    }

    .habitat-spawns .type-badge {
      font-size: 0.5rem;
      padding: 0 4px;
    }

    .habitat-spawns .type-badge-img {
      height: 12px;
    }

    .habitat-spawn-item {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .shiny-badge {
      position: absolute;
      top: 4px;
      right: 4px;
      width: 16px;
      height: 16px;
      background: var(--shiny-pink);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .shiny-badge svg {
      width: 10px;
      height: 10px;
      fill: white;
    }

    .pokemon-card-wrapper {
      position: relative;
      min-width: 0;
      overflow: hidden;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-lg);
      overflow-x: auto;
      padding-bottom: var(--spacing-sm);
      -webkit-overflow-scrolling: touch;
    }

    .tabs::-webkit-scrollbar {
      display: none;
    }

    .tab {
      flex-shrink: 0;
      padding: 10px 20px;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    .tab:hover {
      background: var(--bg-card-hover);
      color: #e8e8f0;
    }

    .tab.active {
      background: linear-gradient(135deg, var(--x-blue), var(--y-red));
      border-color: transparent;
      color: white;
    }

    /* Habitat Schedule */
    .habitat-schedule {
      display: grid;
      gap: var(--spacing-md);
    }

    .habitat-card {
      background: var(--bg-card);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      overflow: hidden;
    }

    .habitat-header {
      padding: var(--spacing-md);
      background: linear-gradient(135deg, rgba(74, 144, 217, 0.2), rgba(217, 74, 109, 0.2));
      border-bottom: 1px solid var(--border-subtle);
    }

    .habitat-name {
      font-weight: 700;
      font-size: 1rem;
      margin: 0 0 var(--spacing-xs);
    }

    .habitat-time {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .habitat-spawns {
      padding: var(--spacing-md);
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: var(--spacing-sm);
    }

    @media (min-width: 480px) {
      .habitat-spawns {
        grid-template-columns: repeat(6, 1fr);
      }
    }

    .habitat-spawns .pokemon-img {
      width: 48px;
      height: 48px;
    }

    /* Bonus Grid */
    .bonus-grid {
      display: grid;
      gap: var(--spacing-md);
    }

    .bonus-card {
      display: flex;
      align-items: flex-start;
      gap: var(--spacing-md);
      padding: var(--spacing-md);
      background: var(--bg-card);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
    }

    .bonus-icon {
      width: 48px;
      height: 48px;
      flex-shrink: 0;
      object-fit: contain;
    }

    .bonus-text {
      font-size: 0.9rem;
      line-height: 1.4;
    }

    .bonus-category {
      font-size: 0.75rem;
      color: var(--mega-gold);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: var(--spacing-xs);
    }

    /* Version Cards */
    .version-cards {
      display: grid;
      gap: var(--spacing-lg);
    }

    @media (min-width: 768px) {
      .version-cards {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .version-card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      border: 2px solid var(--border-subtle);
      overflow: hidden;
      transition: transform 0.2s ease;
    }

    .version-card:hover {
      transform: translateY(-4px);
    }

    .version-card.x-version {
      border-color: var(--x-blue);
    }

    .version-card.y-version {
      border-color: var(--y-red);
    }

    .version-header {
      padding: var(--spacing-lg);
      text-align: center;
    }

    .version-card.x-version .version-header {
      background: linear-gradient(135deg, rgba(74, 144, 217, 0.3), rgba(74, 144, 217, 0.1));
    }

    .version-card.y-version .version-header {
      background: linear-gradient(135deg, rgba(217, 74, 109, 0.3), rgba(217, 74, 109, 0.1));
    }

    .version-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      margin: 0;
    }

    .version-card.x-version .version-title {
      color: var(--x-blue);
    }

    .version-card.y-version .version-title {
      color: var(--y-red);
    }

    .version-legendary {
      margin-top: var(--spacing-md);
    }

    .version-legendary img {
      width: 120px;
      height: 120px;
      margin: 0 auto;
    }

    .version-body {
      padding: var(--spacing-lg);
    }

    .version-detail {
      display: flex;
      align-items: flex-start;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-md);
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .version-detail svg {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
      margin-top: 2px;
    }

    .version-card.x-version .version-detail svg {
      stroke: var(--x-blue);
    }

    .version-card.y-version .version-detail svg {
      stroke: var(--y-red);
    }

    /* Mega Schedule */
    .mega-schedule {
      display: grid;
      gap: var(--spacing-md);
    }

    .mega-day {
      background: var(--bg-card);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      overflow: hidden;
    }

    .mega-day-header {
      padding: var(--spacing-md);
      background: linear-gradient(90deg, rgba(240, 192, 64, 0.2), transparent);
      font-weight: 700;
      border-bottom: 1px solid var(--border-subtle);
    }

    .mega-slots {
      padding: var(--spacing-md);
      display: grid;
      gap: var(--spacing-sm);
    }

    .mega-slot {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      padding: var(--spacing-sm);
      background: rgba(255, 255, 255, 0.02);
      border-radius: var(--radius-sm);
    }

    .mega-time {
      font-size: 0.8rem;
      color: var(--text-muted);
      min-width: 80px;
      font-weight: 600;
    }

    .mega-names {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-sm);
    }

    .mega-name {
      font-size: 0.85rem;
      padding: 4px 10px;
      background: rgba(240, 192, 64, 0.15);
      border-radius: 12px;
      color: var(--mega-gold);
    }

    /* Egg Tabs */
    .egg-section {
      margin-top: var(--spacing-lg);
    }

    .egg-distance {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-md);
      padding-bottom: var(--spacing-sm);
      border-bottom: 1px solid var(--border-subtle);
    }

    .egg-icon {
      width: 32px;
      height: 32px;
    }

    .egg-label {
      font-weight: 700;
      font-size: 1rem;
    }

    /* Loading */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 60vh;
      gap: var(--spacing-lg);
    }

    .loading-spinner {
      width: 48px;
      height: 48px;
      border: 3px solid var(--border-subtle);
      border-top-color: var(--x-blue);
      border-right-color: var(--y-red);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    /* Error */
    .error {
      text-align: center;
      padding: var(--spacing-xl);
    }

    .error-title {
      font-size: 1.25rem;
      margin-bottom: var(--spacing-md);
    }

    .retry-btn {
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: 12px 24px;
      background: linear-gradient(135deg, var(--x-blue), var(--y-red));
      border: none;
      border-radius: var(--radius-md);
      color: white;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease, opacity 0.2s ease;
    }

    .retry-btn:hover {
      opacity: 0.9;
    }

    .retry-btn:active {
      transform: scale(0.98);
    }

    /* Shiny Debuts */
    .shiny-debut-card {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      padding: var(--spacing-md);
      background: linear-gradient(135deg, rgba(255, 107, 157, 0.15), rgba(255, 107, 157, 0.05));
      border: 1px solid rgba(255, 107, 157, 0.3);
      border-radius: var(--radius-md);
    }

    .shiny-debut-card .pokemon-img {
      width: 72px;
      height: 72px;
    }

    .shiny-debut-info {
      flex: 1;
    }

    .shiny-debut-name {
      font-weight: 700;
      font-size: 1rem;
      margin-bottom: var(--spacing-xs);
    }

    .shiny-debut-label {
      font-size: 0.8rem;
      color: var(--shiny-pink);
      font-weight: 600;
    }

    /* Accordion */
    .accordion {
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      overflow: hidden;
    }

    .accordion-item {
      border-bottom: 1px solid var(--border-subtle);
    }

    .accordion-item:last-child {
      border-bottom: none;
    }

    .accordion-header {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--spacing-md);
      background: var(--bg-card);
      border: none;
      color: #e8e8f0;
      font-size: 1rem;
      font-weight: 600;
      text-align: left;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .accordion-header:hover {
      background: var(--bg-card-hover);
    }

    .accordion-icon {
      width: 20px;
      height: 20px;
      transition: transform 0.3s ease;
    }

    .accordion-item.open .accordion-icon {
      transform: rotate(180deg);
    }

    .accordion-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .accordion-item.open .accordion-content {
      max-height: 6000px;
    }

    .accordion-body {
      padding: var(--spacing-md);
      background: rgba(0, 0, 0, 0.2);
    }

    /* Pokemon Modal */
    .pokemon-modal-overlay {
      position: fixed;
      inset: 0;
      z-index: 1000;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--spacing-lg);
      animation: fadeIn 0.2s ease;
    }

    .pokemon-modal-overlay[hidden] {
      display: none;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.82); }
      to { opacity: 1; transform: scale(1); }
    }

    .pokemon-modal {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      padding: var(--spacing-xl) var(--spacing-lg);
      max-width: 300px;
      width: 100%;
      text-align: center;
      position: relative;
      animation: scaleIn 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .pokemon-modal-close {
      position: absolute;
      top: var(--spacing-md);
      right: var(--spacing-md);
      width: 32px;
      height: 32px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid var(--border-subtle);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: var(--text-muted);
      transition: background 0.2s ease, color 0.2s ease;
    }

    .pokemon-modal-close:hover {
      background: rgba(255, 255, 255, 0.15);
      color: #e8e8f0;
    }

    .pokemon-modal-close svg {
      width: 16px;
      height: 16px;
    }

    .pokemon-modal-img-container {
      margin: 0 auto var(--spacing-md);
      display: flex;
      align-items: center;
      justify-content: center;
      width: 180px;
      height: 180px;
    }

    .pokemon-modal-img {
      max-width: 180px;
      max-height: 180px;
      width: auto;
      height: auto;
      object-fit: contain;
      image-rendering: pixelated;
      filter: drop-shadow(0 6px 20px rgba(74, 144, 217, 0.35));
    }

    .pokemon-modal-name {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.35rem;
      font-weight: 700;
      margin: 0 0 var(--spacing-sm);
    }

    .pokemon-modal-types {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 6px;
      margin-bottom: var(--spacing-md);
    }

    .pokemon-modal-types .type-badge {
      font-size: 0.75rem;
      padding: 4px 10px;
      border-radius: 8px;
    }

    .pokemon-modal-types .type-badge-img {
      height: 26px;
    }

    .pokemon-modal-shiny {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 14px;
      background: rgba(255, 107, 157, 0.15);
      border: 1px solid rgba(255, 107, 157, 0.3);
      border-radius: 20px;
      color: var(--shiny-pink);
      font-size: 0.85rem;
      font-weight: 600;
    }

    .pokemon-modal-shiny svg {
      width: 14px;
      height: 14px;
      fill: var(--shiny-pink);
    }

    /* Reduced Motion */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }

    /* Focus */
    button:focus-visible,
    .tab:focus-visible {
      outline: 2px solid var(--x-blue);
      outline-offset: 2px;
    }

    /* Utility */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    .hidden {
      display: none !important;
    }

    /* Ticket CTA */
    .ticket-cta {
      display: block;
      width: 100%;
      padding: var(--spacing-lg);
      background: linear-gradient(135deg, rgba(240, 192, 64, 0.25), rgba(217, 74, 109, 0.2));
      border: 1px solid rgba(240, 192, 64, 0.4);
      border-radius: var(--radius-md);
      margin-bottom: var(--spacing-xl);
      text-align: center;
      text-decoration: none;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .ticket-cta:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(240, 192, 64, 0.2);
    }

    .ticket-cta:active {
      transform: scale(0.98);
    }

    .ticket-cta-label {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--mega-gold);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
    }

    .ticket-cta-label svg {
      width: 20px;
      height: 20px;
      stroke: var(--mega-gold);
    }

    .ticket-cta-bonuses {
      margin-top: var(--spacing-md);
      text-align: left;
    }

    .ticket-cta-bonuses li {
      color: var(--text-muted);
      font-size: 0.85rem;
      line-height: 1.6;
      margin-bottom: var(--spacing-xs);
    }

    /* Mega Debut Card */
    .mega-debut-card {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      padding: var(--spacing-md);
      background: linear-gradient(135deg, rgba(240, 192, 64, 0.15), rgba(240, 192, 64, 0.05));
      border: 1px solid rgba(240, 192, 64, 0.3);
      border-radius: var(--radius-md);
    }

    .mega-debut-name {
      font-weight: 700;
      font-size: 1rem;
      color: var(--mega-gold);
    }

    .mega-debut-icon {
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(240, 192, 64, 0.15);
      border-radius: var(--radius-sm);
      flex-shrink: 0;
    }

    .mega-debut-icon svg {
      width: 24px;
      height: 24px;
      stroke: var(--mega-gold);
    }

    .mega-debuts-grid {
      display: grid;
      gap: var(--spacing-md);
    }

    /* Costume Card */
    .costume-card {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      padding: var(--spacing-md);
      background: var(--bg-card);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
    }

    .costume-icon {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(74, 144, 217, 0.15);
      border-radius: var(--radius-sm);
      flex-shrink: 0;
    }

    .costume-icon svg {
      width: 20px;
      height: 20px;
      stroke: var(--x-blue);
    }

    .costume-text {
      font-size: 0.95rem;
      color: #e8e8f0;
    }

    .costume-grid {
      display: grid;
      gap: var(--spacing-md);
    }

    /* Route Region */
    .route-region {
      display: flex;
      align-items: flex-start;
      gap: var(--spacing-md);
      padding: var(--spacing-md);
      background: rgba(255, 255, 255, 0.02);
      border-radius: var(--radius-sm);
    }

    .route-region-name {
      font-weight: 700;
      font-size: 0.85rem;
      color: var(--x-blue);
      min-width: 100px;
      flex-shrink: 0;
    }

    .route-region-pokemon {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .route-regions-list {
      display: grid;
      gap: var(--spacing-sm);
      margin-top: var(--spacing-lg);
    }

    /* Special Backgrounds */
    .special-bg-item {
      display: flex;
      align-items: flex-start;
      gap: var(--spacing-md);
      padding: var(--spacing-md) 0;
      border-bottom: 1px solid var(--border-subtle);
    }

    .special-bg-item:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }

    .special-bg-item:first-child {
      padding-top: 0;
    }

    .special-bg-icon {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .special-bg-icon svg {
      width: 20px;
      height: 20px;
    }

    .special-bg-text {
      font-size: 0.9rem;
      color: var(--text-muted);
      line-height: 1.6;
    }
  </style>
</head>
<body>
  <div class="bg-pattern" aria-hidden="true">
    <div class="grid-overlay"></div>
  </div>

  <header class="header" role="banner">
    <div class="header-content">
      <div class="logo">GO Tour: Kalos</div>
      <div class="status-badge" id="statusBadge">
        <span class="status-dot"></span>
        <span id="statusText">Loading...</span>
      </div>
    </div>
  </header>

  <main class="main" role="main" id="mainContent">
    <div class="loading" id="loadingState">
      <div class="loading-spinner" aria-hidden="true"></div>
      <p class="loading-text">Loading event data...</p>
    </div>

    <div class="error hidden" id="errorState">
      <h2 class="error-title">Failed to load event data</h2>
      <button class="retry-btn" id="retryBtn" aria-label="Retry loading data">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M1 4v6h6M23 20v-6h-6"/>
          <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
        </svg>
        Retry
      </button>
    </div>

    <div id="eventContent" class="hidden"></div>
  </main>

  <!-- Pokémon Detail Modal -->
  <div id="pokemonModal" class="pokemon-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="modalPokemonName" hidden>
    <div class="pokemon-modal" id="pokemonModalInner">
      <button class="pokemon-modal-close" id="modalCloseBtn" aria-label="Close">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
      <div class="pokemon-modal-img-container">
        <img id="modalPokemonImg" src="" alt="" class="pokemon-modal-img">
      </div>
      <h3 id="modalPokemonName" class="pokemon-modal-name"></h3>
      <div id="modalPokemonTypes" class="pokemon-modal-types"></div>
      <div id="modalShinyBadge" class="pokemon-modal-shiny hidden">
        <svg viewBox="0 0 24 24">
          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
        </svg>
        Shiny Available
      </div>
    </div>
  </div>

  <script>
    'use strict';

    const API_URL = 'https://pokemn.quest/data/eventTypes/pokemon-go-tour.min.json';
    const POKEAPI_URL = 'https://pokeapi.co/api/v2/pokemon/';
    const POKEAPI_CACHE_KEY = 'pokeapi_type_cache';
    const POKEAPI_CONCURRENCY = 5;
    const TYPE_BADGE_PATH = 'public/assets/types/';

    const elements = {
      loadingState: null,
      errorState: null,
      eventContent: null,
      statusText: null,
      retryBtn: null
    };

    let eventData = null;
    let typeIndex = {};

    document.addEventListener('DOMContentLoaded', function() {
      elements.loadingState = document.getElementById('loadingState');
      elements.errorState = document.getElementById('errorState');
      elements.eventContent = document.getElementById('eventContent');
      elements.statusText = document.getElementById('statusText');
      elements.retryBtn = document.getElementById('retryBtn');

      if (elements.retryBtn) {
        elements.retryBtn.addEventListener('click', fetchEventData);
      }

      initPokemonModal();
      fetchEventData();
    });

    async function fetchEventData() {
      showLoading();

      try {
        const eventResponse = await fetch(API_URL);

        if (!eventResponse.ok) {
          throw new Error('Failed to fetch data');
        }

        const data = await eventResponse.json();
        
        const globalEvent = data.find(event => 
          event.eventID && event.eventID.includes('global')
        );

        if (!globalEvent) {
          throw new Error('Global event not found');
        }

        eventData = globalEvent;

        if (elements.statusText) elements.statusText.textContent = 'Loading type data...';
        await fetchMissingTypes(collectAllPokemon(eventData));

        renderEvent(eventData);
        showContent();

        setTimeout(initScrollReveal, 100);
        
      } catch (error) {
        console.error('Error fetching event data:', error);
        showError();
      }
    }

    function showLoading() {
      if (elements.loadingState) elements.loadingState.classList.remove('hidden');
      if (elements.errorState) elements.errorState.classList.add('hidden');
      if (elements.eventContent) elements.eventContent.classList.add('hidden');
      if (elements.statusText) elements.statusText.textContent = 'Loading...';
    }

    function showError() {
      if (elements.loadingState) elements.loadingState.classList.add('hidden');
      if (elements.errorState) elements.errorState.classList.remove('hidden');
      if (elements.eventContent) elements.eventContent.classList.add('hidden');
      if (elements.statusText) elements.statusText.textContent = 'Error';
    }

    function showContent() {
      if (elements.loadingState) elements.loadingState.classList.add('hidden');
      if (elements.errorState) elements.errorState.classList.add('hidden');
      if (elements.eventContent) elements.eventContent.classList.remove('hidden');
      
      if (eventData && elements.statusText) {
        const status = eventData.eventStatus || 'upcoming';
        elements.statusText.textContent = status.charAt(0).toUpperCase() + status.slice(1);
      }
    }

    function renderEvent(event) {
      if (!elements.eventContent) return;

      const html = `
        <!-- Hero -->
        <section class="hero section" aria-labelledby="event-title">
          <img 
            src="${escapeHtml(event.image)}" 
            alt="${escapeHtml(event.name)}"
            class="hero-image"
            loading="eager"
          >
          <div class="hero-overlay">
            <h1 id="event-title" class="event-title">${escapeHtml(event.name)}</h1>
            <div class="event-dates">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
              </svg>
              <span>${formatDateRange(event.start, event.end)}</span>
            </div>
          </div>
        </section>

        ${renderTicketCTA(event.eventInfo, event.exclusiveBonuses)}
        ${renderShinyDebuts(event.shinyDebuts)}
        ${renderMegaDebuts(event.megaDebuts)}
        ${renderCostumedPokemon(event.costumedPokemon)}
        ${renderBranchingResearch(event.branchingResearch)}
        ${renderHabitats(event.habitats, event.habitatRotation)}
        ${renderRoutes(event.routes)}
        ${renderTimedResearchRegions(event.timedResearchRegions)}
        ${renderMegaSchedule(event.megaRaidSchedule)}
        ${renderPokemon(event.pokemon, event.raids)}
        ${renderEggs(event.eggs)}
        ${renderBonuses(event.bonusCategories)}
        ${renderSpecialBackgrounds(event.specialBackgrounds)}
        ${renderSales(event.sales)}
        ${renderWhatsNew(event.whatsNew)}
      `;

      elements.eventContent.innerHTML = html;
      initAccordions();
    }

    function renderTicketCTA(eventInfo, exclusiveBonuses) {
      if (!eventInfo || !eventInfo.ticketUrl) return '';

      const hasBonuses = exclusiveBonuses && exclusiveBonuses.length > 0;

      return `
        <a href="${escapeHtml(eventInfo.ticketUrl)}" class="ticket-cta" target="_blank" rel="noopener noreferrer">
          <span class="ticket-cta-label">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/>
              <path d="M13 5v2"/><path d="M13 17v2"/><path d="M13 11v2"/>
            </svg>
            Get Your Ticket
          </span>
          ${hasBonuses ? `
            <ul class="ticket-cta-bonuses">
              ${exclusiveBonuses.map(b => `<li>${escapeHtml(b)}</li>`).join('')}
            </ul>
          ` : ''}
        </a>
      `;
    }

    function getTypes(pokemon) {
      if (!pokemon) return [];
      const name = (pokemon.name || '').toLowerCase();
      const dex = pokemon.dexNumber;
      return typeIndex[name] || (dex ? typeIndex['__dex_' + dex] : null) || [];
    }

    function renderPokemonCard(p) {
      if (!p) return '';
      const types = getTypes(p);
      const typesAttr = escapeHtml(JSON.stringify(types));
      const isShiny = !!p.canBeShiny;
      return `
        <div class="pokemon-card-wrapper"
          data-name="${escapeHtml(p.name)}"
          data-image="${escapeHtml(p.image || '')}"
          data-shiny="${isShiny}"
          data-types="${typesAttr}">
          <div class="pokemon-card" tabindex="0" role="button" aria-label="${escapeHtml(p.name)}">
            <img
              src="${escapeHtml(p.image || '')}"
              alt="${escapeHtml(p.name)}"
              class="pokemon-img"
              loading="lazy"
            >
            <span class="pokemon-name">${escapeHtml(p.name)}</span>
            ${renderTypeBadges(p)}
          </div>
          ${isShiny ? `
            <div class="shiny-badge" title="Shiny available">
              <svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
            </div>
          ` : ''}
        </div>
      `;
    }

    function renderShinyDebuts(debuts) {
      if (!debuts || debuts.length === 0) return '';

      return `
        <section class="section" aria-labelledby="shiny-debuts-title">
          <div class="section-header">
            <div class="section-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="var(--shiny-pink)" stroke-width="2">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
              </svg>
            </div>
            <h2 id="shiny-debuts-title" class="section-title">Shiny Debuts</h2>
          </div>
          <div class="pokemon-grid">
            ${debuts.map(p => renderPokemonCard(Object.assign({}, p, { canBeShiny: true }))).join('')}
          </div>
        </section>
      `;
    }

    function renderMegaDebuts(megaDebuts) {
      if (!megaDebuts || megaDebuts.length === 0) return '';

      return `
        <section class="section" aria-labelledby="mega-debuts-title">
          <div class="section-header">
            <div class="section-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="var(--mega-gold)" stroke-width="2">
                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
              </svg>
            </div>
            <h2 id="mega-debuts-title" class="section-title">New Mega Evolutions</h2>
          </div>
          <div class="mega-debuts-grid">
            ${megaDebuts.map(name => `
              <div class="mega-debut-card">
                <div class="mega-debut-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                  </svg>
                </div>
                <span class="mega-debut-name">${escapeHtml(name)}</span>
              </div>
            `).join('')}
          </div>
        </section>
      `;
    }

    function renderCostumedPokemon(costumed) {
      if (!costumed || costumed.length === 0) return '';

      return `
        <section class="section" aria-labelledby="costumed-title">
          <div class="section-header">
            <div class="section-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="var(--x-blue)" stroke-width="2">
                <path d="M12 2a4 4 0 0 0-4 4c0 2 2 3 2 6H6s0 4 6 4 6-4 6-4h-4c0-3 2-4 2-6a4 4 0 0 0-4-4z"/>
                <path d="M8 16v2a4 4 0 0 0 8 0v-2"/>
              </svg>
            </div>
            <h2 id="costumed-title" class="section-title">Costumed Pokémon</h2>
          </div>
          <div class="costume-grid">
            ${costumed.map(c => `
              <div class="costume-card">
                <div class="costume-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2a4 4 0 0 0-4 4c0 2 2 3 2 6H6s0 4 6 4 6-4 6-4h-4c0-3 2-4 2-6a4 4 0 0 0-4-4z"/>
                    <path d="M8 16v2a4 4 0 0 0 8 0v-2"/>
                  </svg>
                </div>
                <span class="costume-text">${escapeHtml(c.description)}</span>
              </div>
            `).join('')}
          </div>
        </section>
      `;
    }

    function renderBranchingResearch(research) {
      if (!research || !research.paths) return '';

      const hasDescription = research.description && research.description.length > 0;

      return `
        <section class="section" aria-labelledby="branching-title">
          <div class="section-header">
            <div class="section-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="var(--mega-gold)" stroke-width="2">
                <path d="M6 3v12"/>
                <circle cx="18" cy="6" r="3"/>
                <circle cx="6" cy="18" r="3"/>
                <path d="M18 9a9 9 0 0 1-9 9"/>
              </svg>
            </div>
            <h2 id="branching-title" class="section-title">Choose Your Path</h2>
          </div>
          
          ${hasDescription ? `
            <div class="card" style="margin-bottom: var(--spacing-lg);">
              ${research.description.map(p => `
                <p style="margin: 0 0 var(--spacing-md); color: var(--text-muted); font-size: 0.9rem; line-height: 1.6;">${escapeHtml(p)}</p>
              `).join('')}
            </div>
          ` : `
            <div class="card" style="margin-bottom: var(--spacing-lg);">
              <p style="margin: 0; color: var(--text-muted); font-size: 0.9rem;">
                During the event, ticket-holding Trainers can choose between two Special Research paths. 
                Complete to receive an encounter with a Legendary featuring a Special Background!
              </p>
            </div>
          `}

          <div class="version-cards">
            ${research.paths.map((path, index) => `
              <div class="version-card ${index === 0 ? 'x-version' : 'y-version'}">
                <div class="version-header">
                  <h3 class="version-title">${escapeHtml(path.name)}</h3>
                </div>
                <div class="version-body">
                  ${path.details.map(detail => `
                    <div class="version-detail">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"/>
                      </svg>
                      <span>${escapeHtml(detail)}</span>
                    </div>
                  `).join('')}
                </div>
              </div>
            `).join('')}
          </div>
        </section>
      `;
    }

    function renderHabitats(habitats, rotation) {
      if (!habitats) return '';

      const habitatNames = Object.keys(habitats);

      return `
        <section class="section" aria-labelledby="habitats-title">
          <div class="section-header">
            <div class="section-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="var(--x-blue)" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                <polyline points="9 22 9 12 15 12 15 22"/>
              </svg>
            </div>
            <h2 id="habitats-title" class="section-title">Habitat Rotation</h2>
          </div>
          
          <div class="accordion">
            ${habitatNames.map((name, index) => {
              const habitat = habitats[name];
              const rotationInfo = rotation ? rotation.find(r => r.name === name) : null;
              const timeInfo = habitat.timeInfo || (rotationInfo ? formatTimeSlots(rotationInfo.timeSlots) : '');
              
              return `
                <div class="accordion-item ${index === 0 ? 'open' : ''}">
                  <button
                    class="accordion-header"
                    aria-expanded="${index === 0 ? 'true' : 'false'}"
                    aria-controls="habitat-content-${index}"
                  >
                    <span>
                      ${escapeHtml(name)}
                      ${timeInfo ? `<span style="font-size:0.8rem;font-weight:400;color:var(--text-muted);margin-left:8px;">${escapeHtml(timeInfo)}</span>` : ''}
                    </span>
                    <svg class="accordion-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="6 9 12 15 18 9"/>
                    </svg>
                  </button>
                  <div class="accordion-content" id="habitat-content-${index}">
                    <div class="accordion-body">
                      <div class="pokemon-grid">
                        ${(habitat.spawns || []).map(p => renderPokemonCard(p)).join('')}
                      </div>
                    </div>
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        </section>
      `;
    }

    function renderRoutes(routes) {
      if (!routes) return '';

      const hasDescription = routes.description && routes.description.length > 0;
      const hasPokemon = routes.pokemon && routes.pokemon.length > 0;
      const hasRegional = routes.regionalAppearances && routes.regionalAppearances.length > 0;

      if (!hasDescription && !hasPokemon && !hasRegional) return '';

      return `
        <section class="section" aria-labelledby="routes-title">
          <div class="section-header">
            <div class="section-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="var(--x-blue)" stroke-width="2">
                <circle cx="6" cy="19" r="3"/>
                <path d="M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15"/>
                <circle cx="18" cy="5" r="3"/>
              </svg>
            </div>
            <h2 id="routes-title" class="section-title">Routes</h2>
          </div>

          ${hasDescription ? `
            <div class="card" style="margin-bottom: var(--spacing-lg);">
              ${routes.description.map(p => `
                <p style="margin: 0 0 var(--spacing-md); color: var(--text-muted); font-size: 0.9rem; line-height: 1.6;">${escapeHtml(p)}</p>
              `).join('')}
            </div>
          ` : ''}

          ${hasPokemon ? `
            <div class="card" style="margin-bottom: var(--spacing-lg);">
              <h3 style="margin: 0 0 var(--spacing-md); font-size: 1rem;">Route Pokémon</h3>
              <div class="pokemon-grid">
                ${routes.pokemon.map(p => renderPokemonCard(p)).join('')}
              </div>
            </div>
          ` : ''}

          ${hasRegional ? `
            <div class="card">
              <h3 style="margin: 0 0 var(--spacing-md); font-size: 1rem;">Regional Appearances</h3>
              <div class="route-regions-list">
                ${routes.regionalAppearances.map(r => `
                  <div class="route-region">
                    <span class="route-region-name">${escapeHtml(r.region)}</span>
                    <span class="route-region-pokemon">${escapeHtml(r.pokemon)}</span>
                  </div>
                `).join('')}
              </div>
            </div>
          ` : ''}
        </section>
      `;
    }

    function renderTimedResearchRegions(regions) {
      if (!regions || regions.length === 0) return '';

      return `
        <section class="section" aria-labelledby="timed-research-title">
          <div class="section-header">
            <div class="section-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="var(--y-red)" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
            </div>
            <h2 id="timed-research-title" class="section-title">Timed Research by Region</h2>
          </div>

          <div class="accordion">
            ${regions.map((r, index) => `
              <div class="accordion-item ${index === 0 ? 'open' : ''}">
                <button 
                  class="accordion-header" 
                  aria-expanded="${index === 0 ? 'true' : 'false'}"
                  aria-controls="timed-research-content-${index}"
                >
                  <span>${escapeHtml(r.region)}</span>
                  <svg class="accordion-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"/>
                  </svg>
                </button>
                  <div class="accordion-content" id="timed-research-content-${index}">
                  <div class="accordion-body">
                    <div class="pokemon-grid">
                      ${(r.pokemon || []).map(p => renderPokemonCard(p)).join('')}
                    </div>
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
        </section>
      `;
    }

    function renderMegaSchedule(schedule) {
      if (!schedule) return '';

      return `
        <section class="section" aria-labelledby="mega-title">
          <div class="section-header">
            <div class="section-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="var(--mega-gold)" stroke-width="2">
                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
              </svg>
            </div>
            <h2 id="mega-title" class="section-title">Mega Raid Schedule</h2>
          </div>
          
          <div class="mega-schedule">
            ${schedule.saturday ? `
              <div class="mega-day">
                <div class="mega-day-header">Saturday, February 28</div>
                <div class="mega-slots">
                  ${schedule.saturday.map(slot => `
                    <div class="mega-slot">
                      <span class="mega-time">${escapeHtml(slot.start)} - ${escapeHtml(slot.end)}</span>
                      <div class="mega-names">
                        ${slot.items.map(name => `<span class="mega-name">${escapeHtml(name)}</span>`).join('')}
                      </div>
                    </div>
                  `).join('')}
                </div>
              </div>
            ` : ''}
            ${schedule.sunday ? `
              <div class="mega-day">
                <div class="mega-day-header">Sunday, March 1</div>
                <div class="mega-slots">
                  ${schedule.sunday.map(slot => `
                    <div class="mega-slot">
                      <span class="mega-time">${escapeHtml(slot.start)} - ${escapeHtml(slot.end)}</span>
                      <div class="mega-names">
                        ${slot.items.map(name => `<span class="mega-name">${escapeHtml(name)}</span>`).join('')}
                      </div>
                    </div>
                  `).join('')}
                </div>
              </div>
            ` : ''}
          </div>
        </section>
      `;
    }

    function renderPokemon(pokemon, raids) {
      const hasPokemon = pokemon && pokemon.length > 0;
      const hasRaids = raids && raids.length > 0;

      if (!hasPokemon && !hasRaids) return '';

      return `
        <section class="section" aria-labelledby="pokemon-title">
          <div class="section-header">
            <div class="section-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="var(--y-red)" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <circle cx="12" cy="12" r="3"/>
                <line x1="2" y1="12" x2="9" y2="12"/>
                <line x1="15" y1="12" x2="22" y2="12"/>
              </svg>
            </div>
            <h2 id="pokemon-title" class="section-title">Featured Pokemon</h2>
          </div>

          <div class="accordion">
            ${hasRaids ? `
              <div class="accordion-item open">
                <button class="accordion-header" aria-expanded="true" aria-controls="raids-accordion-content">
                  <span>Raid Bosses</span>
                  <svg class="accordion-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"/>
                  </svg>
                </button>
                <div class="accordion-content" id="raids-accordion-content">
                  <div class="accordion-body">
                    <div class="pokemon-grid">
                      ${raids.map(p => renderPokemonCard(p)).join('')}
                    </div>
                  </div>
                </div>
              </div>
            ` : ''}
            ${hasPokemon ? `
              <div class="accordion-item ${hasRaids ? '' : 'open'}">
                <button class="accordion-header" aria-expanded="${hasRaids ? 'false' : 'true'}" aria-controls="spawns-accordion-content">
                  <span>Wild Spawns (Incense)</span>
                  <svg class="accordion-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"/>
                  </svg>
                </button>
                <div class="accordion-content" id="spawns-accordion-content">
                  <div class="accordion-body">
                    <div class="pokemon-grid">
                      ${pokemon.map(p => renderPokemonCard(p)).join('')}
                    </div>
                  </div>
                </div>
              </div>
            ` : ''}
          </div>
        </section>
      `;
    }

    function renderEggs(eggs) {
      if (!eggs) return '';

      const distances = ['2km', '5km', '10km'].filter(d => eggs[d] && eggs[d].length > 0);

      if (distances.length === 0) return '';

      return `
        <section class="section" aria-labelledby="eggs-title">
          <div class="section-header">
            <div class="section-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="var(--x-blue)" stroke-width="2">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/>
                <path d="M12 2v20"/>
              </svg>
            </div>
            <h2 id="eggs-title" class="section-title">Egg Hatches</h2>
          </div>

          <div class="accordion">
            ${distances.map((distance, index) => `
              <div class="accordion-item ${index === 0 ? 'open' : ''}">
                <button
                  class="accordion-header"
                  aria-expanded="${index === 0 ? 'true' : 'false'}"
                  aria-controls="egg-content-${index}"
                >
                  <span style="display:flex;align-items:center;gap:8px;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--mega-gold)" stroke-width="2">
                      <ellipse cx="12" cy="14" rx="7" ry="8"/>
                      <path d="M12 2C8 6 5 10 5 14"/>
                    </svg>
                    ${escapeHtml(distance)} Eggs
                  </span>
                  <svg class="accordion-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"/>
                  </svg>
                </button>
                <div class="accordion-content" id="egg-content-${index}">
                  <div class="accordion-body">
                    <div class="pokemon-grid">
                      ${(eggs[distance] || []).map(p => renderPokemonCard(p)).join('')}
                    </div>
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
        </section>
      `;
    }

    function renderBonuses(categories) {
      if (!categories || categories.length === 0) return '';

      return `
        <section class="section" aria-labelledby="bonuses-title">
          <div class="section-header">
            <div class="section-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="var(--mega-gold)" stroke-width="2">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
            </div>
            <h2 id="bonuses-title" class="section-title">Event Bonuses</h2>
          </div>

          <div class="accordion">
            ${categories.map((cat, index) => `
              <div class="accordion-item ${index === 0 ? 'open' : ''}">
                <button 
                  class="accordion-header" 
                  aria-expanded="${index === 0 ? 'true' : 'false'}"
                  aria-controls="bonus-content-${index}"
                >
                  <span>${escapeHtml(cat.category)}</span>
                  <svg class="accordion-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"/>
                  </svg>
                </button>
                <div class="accordion-content" id="bonus-content-${index}">
                  <div class="accordion-body">
                    ${cat.timeframe ? `<p style="margin: 0 0 var(--spacing-md); font-size: 0.85rem; color: var(--text-muted);">${escapeHtml(cat.timeframe)}</p>` : ''}
                    <div class="bonus-grid">
                      ${(cat.bonuses || []).map(bonus => `
                        <div class="bonus-card">
                          <img 
                            src="${escapeHtml(bonus.image)}" 
                            alt=""
                            class="bonus-icon"
                            loading="lazy"
                          >
                          <p class="bonus-text">${escapeHtml(bonus.text)}</p>
                        </div>
                      `).join('')}
                    </div>
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
        </section>
      `;
    }

    function renderSpecialBackgrounds(backgrounds) {
      if (!backgrounds || backgrounds.length === 0) return '';

      return `
        <section class="section" aria-labelledby="special-bg-title">
          <div class="section-header">
            <div class="section-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="var(--shiny-pink)" stroke-width="2">
                <path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/>
                <circle cx="12" cy="13" r="3"/>
              </svg>
            </div>
            <h2 id="special-bg-title" class="section-title">Special Backgrounds</h2>
          </div>

          <div class="card">
            ${backgrounds.map(text => `
              <div class="special-bg-item">
                <div class="special-bg-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="var(--shiny-pink)" stroke-width="2">
                    <path d="M12 3l1.5 4.5H18l-3.5 2.5L16 14.5 12 11.5 8 14.5l1.5-4.5L6 7.5h4.5z"/>
                  </svg>
                </div>
                <span class="special-bg-text">${escapeHtml(text)}</span>
              </div>
            `).join('')}
          </div>
        </section>
      `;
    }

    function renderSales(items) {
      if (!items || items.length === 0) return '';

      return `
        <section class="section" aria-labelledby="sales-title">
          <div class="section-header">
            <div class="section-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="var(--mega-gold)" stroke-width="2">
                <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                <line x1="3" y1="6" x2="21" y2="6"/>
                <path d="M16 10a4 4 0 0 1-8 0"/>
              </svg>
            </div>
            <h2 id="sales-title" class="section-title">Shop &amp; Avatar Items</h2>
          </div>

          <div class="card">
            <ul style="margin: 0; padding-left: var(--spacing-lg);">
              ${items.map(item => `
                <li style="margin-bottom: var(--spacing-md); color: var(--text-muted); font-size: 0.9rem; line-height: 1.6;">
                  ${escapeHtml(item)}
                </li>
              `).join('')}
            </ul>
          </div>
        </section>
      `;
    }

    function renderWhatsNew(items) {
      if (!items || items.length === 0) return '';

      return `
        <section class="section" aria-labelledby="whatsnew-title">
          <div class="section-header">
            <div class="section-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="var(--y-red)" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="16" x2="12" y2="12"/>
                <line x1="12" y1="8" x2="12.01" y2="8"/>
              </svg>
            </div>
            <h2 id="whatsnew-title" class="section-title">What's New</h2>
          </div>

          <div class="card">
            <ul style="margin: 0; padding-left: var(--spacing-lg);">
              ${items.map(item => `
                <li style="margin-bottom: var(--spacing-md); color: var(--text-muted); font-size: 0.9rem; line-height: 1.6;">
                  ${escapeHtml(item)}
                </li>
              `).join('')}
            </ul>
          </div>
        </section>
      `;
    }

    function initAccordions() {
      const headers = document.querySelectorAll('.accordion-header');
      
      headers.forEach(header => {
        header.addEventListener('click', function() {
          const item = this.closest('.accordion-item');
          const isOpen = item.classList.contains('open');
          
          item.classList.toggle('open');
          this.setAttribute('aria-expanded', !isOpen);
        });
      });
    }

    function initScrollReveal() {
      const sections = document.querySelectorAll('.section');
      
      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry, index) => {
          if (entry.isIntersecting) {
            setTimeout(() => {
              entry.target.classList.add('visible');
            }, index * 100);
            observer.unobserve(entry.target);
          }
        });
      }, {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
      });

      sections.forEach(section => observer.observe(section));
    }

    function formatDateRange(start, end) {
      if (!start || !end) return 'Dates TBA';
      
      try {
        const startDate = new Date(start);
        const endDate = new Date(end);
        
        const options = { month: 'long', day: 'numeric' };
        const startStr = startDate.toLocaleDateString('en-US', options);
        const endStr = endDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
        
        return `${startStr} - ${endStr}, ${startDate.getFullYear()}`;
      } catch (e) {
        return 'Dates TBA';
      }
    }

    function formatTimeSlots(slots) {
      if (!slots || slots.length === 0) return '';
      
      return slots.map(slot => `${slot.start} - ${slot.end}`).join(' & ');
    }

    /**
     * Collect all Pokémon objects from every section of the event data.
     * Only collects objects with a `name` property (skips strings, schedule slots, etc.).
     */
    function collectAllPokemon(event) {
      if (!event) return [];
      const all = [];
      const push = arr => {
        if (!Array.isArray(arr)) return;
        for (const item of arr) {
          if (item && typeof item === 'object' && item.name) all.push(item);
        }
      };

      push(event.shinyDebuts);
      push(event.pokemon);
      push(event.raids);

      // Habitats: { "Habitat Name": { spawns: [...], rareSpawns: [...] } }
      if (event.habitats) {
        for (const habitat of Object.values(event.habitats)) {
          if (habitat && typeof habitat === 'object') {
            push(habitat.spawns);
            push(habitat.rareSpawns);
          }
        }
      }
      if (event.routes) {
        push(event.routes.pokemon);
      }
      if (event.timedResearchRegions) {
        for (const region of event.timedResearchRegions) {
          push(region.pokemon);
        }
      }
      if (event.eggs) {
        for (const eggGroup of Object.values(event.eggs)) {
          push(eggGroup);
        }
      }
      return all;
    }

    /**
     * Normalize a Pokémon name for PokéAPI lookup.
     * Strips costume prefixes, converts to lowercase, handles special forms.
     */
    function normalizeForPokeApi(name) {
      if (!name) return null;
      let n = name.toLowerCase().trim();

      // Strip common costume/hat prefixes that appear before the base name
      // e.g. "Calem's Hat Pikachu" → "pikachu", "Flower Crown Eevee" → "eevee"
      const costumePatterns = [
        /^.*?'s\s+hat\s+/i,
        /^.*?\s+hat\s+/i,
        /^flower\s+crown\s+/i,
        /^festive\s+/i,
        /^party\s+/i,
        /^winter\s+/i,
        /^summer\s+/i,
        /^spring\s+/i,
        /^autumn\s+/i,
        /^halloween\s+/i,
        /^holiday\s+/i,
        /^costume\s+/i,
        /^shadow\s+/i,
      ];
      for (const pat of costumePatterns) {
        const cleaned = n.replace(pat, '');
        if (cleaned && cleaned !== n) {
          n = cleaned;
          break;
        }
      }

      // Handle variant/form prefixes: "Blue Flower Flabébé" → "flabebe"
      // Keep only the last word if it looks like a Pokémon name after a form descriptor
      const colorFormPattern = /^(?:red|blue|orange|yellow|white|black|pink|green|purple)\s+(?:flower|stripe|core)\s+/i;
      n = n.replace(colorFormPattern, '');

      // Strip parenthetical form info: "Furfrou (Debutante)" → "furfrou"
      // PokéAPI uses the base species name; form variants share types
      n = n.replace(/\s*\(.*?\)\s*/g, '').trim();

      // Normalize special characters
      n = n.normalize('NFD').replace(/[\u0300-\u036f]/g, ''); // Remove diacritics (é → e)
      n = n.replace(/['\u2019.:]/g, '');                      // Remove apostrophes, periods, colons
      n = n.replace(/\s+/g, '-');                              // Spaces → hyphens
      n = n.replace(/[^a-z0-9-]/g, '');                        // Strip remaining special chars
      n = n.replace(/-+/g, '-').replace(/^-|-$/g, '');          // Clean up hyphens

      return n || null;
    }

    /**
     * Load PokéAPI type cache from sessionStorage.
     */
    function loadPokeApiCache() {
      try {
        const raw = sessionStorage.getItem(POKEAPI_CACHE_KEY);
        return raw ? JSON.parse(raw) : {};
      } catch (e) {
        return {};
      }
    }

    /**
     * Save PokéAPI type cache to sessionStorage.
     */
    function savePokeApiCache(cache) {
      try {
        sessionStorage.setItem(POKEAPI_CACHE_KEY, JSON.stringify(cache));
      } catch (e) { /* quota exceeded, ignore */ }
    }

    /**
     * Fetch a single Pokémon's types from PokéAPI.
     * Returns array of type strings or null on failure.
     */
    async function fetchPokeApiTypes(identifier) {
      try {
        const resp = await fetch(POKEAPI_URL + encodeURIComponent(identifier));
        if (!resp.ok) return null;
        const data = await resp.json();
        if (!data.types || data.types.length === 0) return null;
        return data.types
          .sort((a, b) => a.slot - b.slot)
          .map(t => t.type.name);
      } catch (e) {
        return null;
      }
    }

    /**
     * Fetch missing type data from PokéAPI for Pokémon not in typeIndex.
     * Uses dexNumber (preferred) or cleaned name as the lookup key.
     * Respects concurrency limits and caches results in sessionStorage.
     */
    async function fetchMissingTypes(pokemonList) {
      if (!pokemonList || pokemonList.length === 0) return;

      const cache = loadPokeApiCache();

      // Restore cached entries into typeIndex first
      for (const [key, types] of Object.entries(cache)) {
        if (!typeIndex[key]) typeIndex[key] = types;
        if (key.startsWith('__dex_') && !typeIndex[key]) {
          typeIndex[key] = types;
        }
      }

      // Collect unique Pokémon that still need lookups
      const needed = new Map(); // key → { dex, apiName }
      for (const p of pokemonList) {
        if (!p || !p.name) continue;
        const name = p.name.toLowerCase();
        const dex = p.dexNumber;
        if (typeIndex[name] || (dex && typeIndex['__dex_' + dex])) continue;

        // Prefer dexNumber lookup, fall back to normalized name
        const lookupKey = dex ? String(dex) : normalizeForPokeApi(p.name);
        if (!lookupKey) continue;

        // Check cache
        const cacheKey = dex ? '__dex_' + dex : name;
        if (cache[cacheKey]) {
          typeIndex[name] = cache[cacheKey];
          if (dex) typeIndex['__dex_' + dex] = cache[cacheKey];
          continue;
        }

        if (!needed.has(lookupKey)) {
          needed.set(lookupKey, { dex, name, lookupKey });
        }
      }

      if (needed.size === 0) return;

      // Fetch in batches with limited concurrency
      const entries = [...needed.values()];
      let dirty = false;

      for (let i = 0; i < entries.length; i += POKEAPI_CONCURRENCY) {
        const batch = entries.slice(i, i + POKEAPI_CONCURRENCY);
        const results = await Promise.all(
          batch.map(async ({ dex, name, lookupKey }) => {
            const types = await fetchPokeApiTypes(lookupKey);
            return { dex, name, types };
          })
        );

        for (const { dex, name, types } of results) {
          if (!types) continue;
          dirty = true;
          typeIndex[name] = types;
          if (dex) {
            typeIndex['__dex_' + dex] = types;
            cache['__dex_' + dex] = types;
          }
          cache[name] = types;
        }
      }

      if (dirty) savePokeApiCache(cache);
    }

    function renderTypeBadges(pokemon) {
      if (!pokemon) return '';
      const name = (pokemon.name || '').toLowerCase();
      const dex = pokemon.dexNumber;
      const types = typeIndex[name] || (dex ? typeIndex['__dex_' + dex] : null);
      if (!types || types.length === 0) return '';
      return `<div class="type-badges">${types.map(t =>
        `<img src="${TYPE_BADGE_PATH}${encodeURIComponent(t)}.svg" alt="${escapeHtml(t)}" class="type-badge-img" loading="lazy">`
      ).join('')}</div>`;
    }

    function initPokemonModal() {
      const overlay = document.getElementById('pokemonModal');
      if (!overlay) return;

      const closeBtn = document.getElementById('modalCloseBtn');
      const imgEl = document.getElementById('modalPokemonImg');
      const nameEl = document.getElementById('modalPokemonName');
      const typesEl = document.getElementById('modalPokemonTypes');
      const shinyEl = document.getElementById('modalShinyBadge');

      function openModal(wrapper) {
        const name = wrapper.dataset.name || '';
        const image = wrapper.dataset.image || '';
        const isShiny = wrapper.dataset.shiny === 'true';
        let types = [];
        try { types = JSON.parse(wrapper.dataset.types || '[]'); } catch (e) {}

        imgEl.src = image;
        imgEl.alt = name;
        nameEl.textContent = name;

        typesEl.innerHTML = types.map(t =>
          `<img src="${TYPE_BADGE_PATH}${encodeURIComponent(t)}.svg" alt="${escapeHtml(t)}" class="type-badge-img">`
        ).join('');

        shinyEl.classList.toggle('hidden', !isShiny);
        overlay.removeAttribute('hidden');
        document.body.style.overflow = 'hidden';
        if (closeBtn) closeBtn.focus();
      }

      function closeModal() {
        overlay.setAttribute('hidden', '');
        document.body.style.overflow = '';
      }

      overlay.addEventListener('click', function(e) {
        if (e.target === overlay) closeModal();
      });

      if (closeBtn) closeBtn.addEventListener('click', closeModal);

      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && !overlay.hasAttribute('hidden')) {
          closeModal();
          return;
        }
        if ((e.key === 'Enter' || e.key === ' ') && !overlay.hasAttribute('hidden') === false) {
          const card = document.activeElement;
          if (!card || !card.classList.contains('pokemon-card')) return;
          const wrapper = card.closest('.pokemon-card-wrapper[data-name]');
          if (wrapper) {
            e.preventDefault();
            openModal(wrapper);
          }
        }
      });

      // Event delegation — works for dynamically rendered cards
      document.addEventListener('click', function(e) {
        const card = e.target.closest('.pokemon-card');
        if (!card) return;
        const wrapper = card.closest('.pokemon-card-wrapper[data-name]');
        if (wrapper) openModal(wrapper);
      });
    }

    function escapeHtml(str) {
      if (!str) return '';
      
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }
  </script>
</body>
</html>